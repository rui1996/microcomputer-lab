STACK SEGMENT PARA STACK
	DW 128H DUP(0)
STACK ENDS

DATA SEGMENT
CLINE 	DB 0DH, 0AH, '$'
SIN     
	DB 080H, 096H, 0AEH, 0C5H, 0D8H, 0E9H, 0F5H, 0FDH
    DB 0FFH, 0FDH, 0F5H, 0E9H, 0D8H, 0C5H, 0AEH, 096H
    DB 080H, 066H, 04EH, 038H, 025H, 015H, 009H, 004H
    DB 000H, 004H, 009H, 015H, 025H, 038H, 04EH, 066H
NUM   	
	DW 00077H, 0006CH, 0005FH, 00059H, 0004FH, 00047H, 0003FH
DATA ENDS

CODE SEGMENT
ASSUME CS:CODE, DS:DATA, SS:STACK
START:
	MOV AX, DATA
	MOV DS, AX
    MOV DX, 0E48BH
	MOV AL, 10010001B
	OUT DX, AL
CIN:            
	MOV AH, 01H         
    INT 21H
    CMP AL, 48 
    JLE EXIT
    SUB AL, 49
    CMP AL, 7
    JGE EXIT
    MOV AH, 0
    MOV SI, AX
    ADD SI, SI
    CALL SING
    JMP CIN
EXIT:           
	MOV AH, 4CH
	INT 21H

SING PROC NEAR
    PUSH CX
    PUSH AX
    PUSH BX
    PUSH DX
    MOV CH, 100    ;sing time
SMUL:           
	MOV CL, 0
    MOV BX, OFFSET SIN
SONE:           
	MOV AL, CL
    XLAT 
    MOV DX, 0E490H
    OUT DX, AL
    CALL PLUSONESEC
    ADD CL, 1
    CMP CL, 32
    JL SONE 
    SUB CH, 1
    JNZ SMUL  
    POP DX
    POP BX
    POP AX
    POP CX
    RET 
SING ENDP

PLUSONESEC PROC NEAR
	PUSH AX
	PUSH BX
	PUSH DX
	MOV BX, OFFSET NUM 
    MOV AL, 00110000B	;set 1Hz timer
	MOV DX, 0E483H
	OUT DX, AL
    MOV AX, [BX+SI]
	MOV DX, 0E480H
	OUT DX, AL
	MOV AL, AH
	OUT DX, AL
    MOV DX, 0E488H
SEE:		
	IN AL, DX
	AND AL, 1
	JZ SEE 
	POP DX
	POP BX
	POP AX
    RET
PLUSONESEC ENDP

CODE ENDS
END START
